<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
      }
      .card {
        width: 33.33%;
        padding: 16px;
      }
      .card .card-body {
        border: 1px solid #f1f1f1;
        box-shadow: 0 2px 4px -2px rgb(61, 61, 61);
        display: flex;
        flex-flow: row wrap;
      }
      .card .label,
      .card .value {
        display: block;
        padding: 8px 16px;
        margin-bottom: 10px;
      }
      .card .label {
        font-weight: 900;
        width: 30%;
        /* background-color: coral; */
      }
      .card .value {
        width: 70%;
        /* background-color: darksalmon; */
      }
    </style>
  </head>
  <body>
    <button id="btn-load-name">Load Name</button>
    <button id="page1">Load Page 1</button>
    <button id="page2">Load Page 2</button>
    <button id="xml1">Load Student XML</button>
    <button id="json">JSON Intro</button>
    <button id="json1">Load Student JSON</button>
    <h1></h1>
    <div id="main"></div>

    <script>
      const Student = function (firstName, lastName, score) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.score = score;
      };

      let studentList = [];

      document.getElementById('btn-load-name').onclick = function () {
        const xhttp = new XMLHttpRequest();

        console.log(xhttp.readyState);

        xhttp.onreadystatechange = function () {
          console.log(this.readyState);
          console.log(this.status);

          if (this.readyState === 4 && this.status === 200) {
            console.log('Answer is ready');
            console.log(this.responseText);

            document.querySelector('h1').innerHTML = this.responseText;
          }
        };

        /*
            open(method, url, async)
                method :
                    'GET'    جهت دریافت اطلاعات
                    'POST'   جهت ایجاد اطلاعت جدید
                    'DELETE' برای حذف اطلاعات
                    'PUT'    برای به روز رسانی
                    'PATCH'
        */
        xhttp.open('GET', '/data/my-data.txt', true);

        xhttp.send();
      };

      document.getElementById('page1').onclick = function () {
        const xhttp = new XMLHttpRequest();
        xhttp.open('GET', '/partial_page/page1.html', true);
        xhttp.send();

        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200) {
            document.getElementById('main').innerHTML = this.responseText;
          }
        };
      };
      document.getElementById('page2').onclick = function () {
        const xhttp = new XMLHttpRequest();
        xhttp.open('GET', '/partial_page/page2.html', true);
        xhttp.send();

        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200) {
            document.getElementById('main').innerHTML = this.responseText;
          }
        };
      };

      document.getElementById('xml1').onclick = function () {
        const xhttp = new XMLHttpRequest();
        xhttp.open('GET', '/data/student_list.xml', true);
        xhttp.send();

        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200) {
            // document.getElementById('main').innerHTML = this.responseText;
            // console.log(this.response);
            // console.log(this.responseText);
            // console.log(this.responseXML);

            let students = this.responseXML.querySelectorAll('student');

            fillStudentList(students);

            // studentList.sort(function(s1, s2){
            //   return s2.score - s1.score
            // })

            studentList.sort(function (s1, s2) {
              let result;

              if (s1.lastName > s2.lastName) result = 1;
              else if (s1.lastName < s2.lastName) result = -1;
              else result = 0;

              return result;
            });

            showStudentList();
          }
        };
      };

      const fillStudentList = function (students) {
        students.forEach(function (student) {
          let firstName = student.querySelector('firstname').innerHTML;
          let lastName = student.querySelector('lastname').innerHTML;
          let score = parseInt(student.querySelector('score').innerHTML);

          studentList.push(new Student(firstName, lastName, score));
        });
      };

      const showStudentList = function () {
        let row = '<div class="row">';
        studentList.forEach(function (student) {
          row += `
                <div class="card">
                  <div class="card-body">
                    <span class="label">First Name :</span> 
                    <span class="value">${student.firstName}</span> 
                    <span class="label">Last Name :</span> 
                    <span class="value">${student.lastName}</span> 
                    <span class="label">Score :</span> 
                    <span class="value">${student.score}</span> 
                  </div>
                </div>
              `;
        });

        row += '</div>';

        document.getElementById('main').innerHTML = row;
      };

      document.getElementById('json').onclick = function () {
        let studentObject = {
          firstName: 'Hamid',
          lastName: 'Matin',
          score: 75,
          course: {
            name: 'Web III',
            duration: 58,
          },
        };
        console.log(studentObject);

        /***********
         * JSON.stringify(obj) => convert to json
         */
        let studentJSON = JSON.stringify(studentObject);

        console.log(studentJSON);

        /****************
         * JSON.parse(json) => convert to object
         */
        let newStudent = JSON.parse(studentJSON);
        console.log(newStudent);
      };

      document.getElementById('json1').onclick = function () {
        const xhttp = new XMLHttpRequest();
        xhttp.open('GET', '/data/student.json', true);
        xhttp.send();

        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200) {
            console.log(this.responseText);
            console.log(this.responseXML);

            // fillStudentList(students);
            studentList = JSON.parse(this.responseText);

            // studentList.sort(function(s1, s2){
            //   return s2.score - s1.score
            // })

            studentList.sort(function (s1, s2) {
              let result;

              if (s1.lastName > s2.lastName) result = 1;
              else if (s1.lastName < s2.lastName) result = -1;
              else result = 0;

              return result;
            });

            showStudentList();
          }
        };
      };
    </script>
  </body>
</html>
